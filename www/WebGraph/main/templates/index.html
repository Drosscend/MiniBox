{% extends './bootstrap/index.html' %}

{% block content %}

    <script>
    {% if lines %}
        // jquery function
        var chart = undefined;
        $(document).ready(function(){
            if(chart != undefined && chart != null){
                chart.destroy();
            }

            var new_width = {{ lines|length }} * 10;

            // Modification de la largeur en fonction des données
            if(new_width>1000){
                document.getElementById("chart-container").style.width = new_width + "px";
            }else{
                document.getElementById("chart-container").style.width = 1000 + "px";
            }

            // Header : date,occurence,top-left,top-right,bottom-left,bottom-right,classe

            // Création de 4 graphiques en fonction des directions
            var date = [];
            var occurence = [];
            var top_left = [];
            var top_right = [];
            var bottom_left = [];
            var bottom_right = [];
            var classe = [];

            {% for line in lines %}
                date.push("{{line.0}}");
                occurence.push({{line.1}});
                top_left.push({{line.2}});
                top_right.push({{line.3}});
                bottom_left.push({{line.4}});
                bottom_right.push({{line.5}});
                classe.push("{{line.6}}");
            {% endfor %}

            // Création du graphique
            var ctx = document.getElementById('graphique').getContext('2d');
            chart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: date,
                    datasets: [{
                        label: 'Top Left',
                        data: top_left,
                        fill: false,
                        backgroundColor: 'rgba(255, 99, 132, 0.2)',
                        borderColor: 'rgba(255, 99, 132, 1)'
                    },{
                        label: 'Top Right',
                        data: top_right,
                        fill: false,
                        backgroundColor: 'rgba(54, 162, 235, 0.2)',
                        borderColor: 'rgba(54, 162, 235, 1)'
                    },{
                        label: 'Bottom Left',
                        data: bottom_left,
                        fill: false,
                        backgroundColor: 'rgba(255, 206, 86, 0.2)',
                        borderColor: 'rgba(255, 206, 86, 1)'
                    },{
                        label: 'Bottom Right',
                        data: bottom_right,
                        fill: false,
                        backgroundColor: 'rgba(75, 192, 192, 0.2)',
                        borderColor: 'rgba(75, 192, 192, 1)'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        yAxes: [{
                            ticks: {
                                beginAtZero: true,
                                stepSize: 1
                            }
                        }]
                    },
                    tooltips: {
                        callbacks: {
                            label: function(tooltipItem, data) {
                                var label = data.datasets[tooltipItem.datasetIndex].label || '';
                                if (label) {
                                    label += ': ';
                                }
                                label += tooltipItem.yLabel;
                                return label;
                            }
                        }
                    }
                }
            });
        });
    {% endif %}
    </script>

    <div class="row gx-4 gx-lg-5 row-cols-2 row-cols-md-3 row-cols-xl-4 justify-content-center">
        {% load crispy_forms_tags %}
        <form action="" method="post" enctype="multipart/form-data">
            {% csrf_token %}
            {{ form }}
            {% if error %}
            <label class="text-danger ">{{ error }}</label>
            {% endif %}
            <div class="form-group mt-3 text-center">
                <input type="submit" class="btn btn-secondary" value="Envoyer">
            </div>
        </form>
    </div>
    {% if lines %}
    <div class="row justify-content-center mt-2">
        <div class="col-5" style="width:1000px; overflow-x: auto;">
            <div id="chart-container" style="height:400px">
                <canvas id="graphique"></canvas>
            </div>
        </div>
    </div>
    {% endif %}
{% endblock %}